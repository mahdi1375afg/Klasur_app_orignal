CREATE TABLE benutzer (
 id INT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
 benutzername varchar(55) NOT NULL,
 passwort varchar(255) NOT NULL
);

CREATE TABLE modul (
 id INT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
 name varchar(255) NOT NULL
);

CREATE TABLE klausur (
 id INT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
 name VARCHAR(255) NOT NULL,
 datum DATE NOT NULL
);

CREATE TYPE taxonomie_stufe AS ENUM (
 'Erinnern',
 'Verstehen',
 'Anwenden',
 'Analysieren',
 'Bewerten',
 'Erschaffen'
);

CREATE TABLE taxonomie_level (
 id INT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
 name taxonomie_stufe NOT NULL
);


CREATE TABLE aufgabe (
 id INT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
 name VARCHAR(255) NOT NULL,
 aufgabentext TEXT NOT NULL,
 zeit INTERVAL NOT NULL,
 format VARCHAR(20) NOT NULL,
 taxonomie_id INT,
 FOREIGN KEY (taxonomie_id) REFERENCES taxonomie_level(id)
);

CREATE TABLE offene_aufgabe (
 musterloesung TEXT NOT NULL,
 aufgabe_id INT PRIMARY KEY,
 FOREIGN KEY (aufgabe_id) REFERENCES aufgabe(id)
);

CREATE TYPE aufgaben_typ AS ENUM (
 'Single-Choice',
 'Multiple-Choice',
 'Wahr/Falsch',
 'LÃ¼ckentext',
 'Zuordnung',
 'Ranking'
);

CREATE TABLE geschlossene_aufgabe (
 typ aufgaben_typ NOT NULL,
 aufgabe_id INT PRIMARY KEY,
 FOREIGN KEY (aufgabe_id) REFERENCES aufgabe(id)
);


CREATE TABLE antwortmoeglichkeit_geschlossen (
 id INT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
 antworttext TEXT NOT NULL,
 ist_korrekt BOOLEAN NOT NULL,
 geschlossene_aufgabe_id INT NOT NULL,
 FOREIGN KEY (geschlossene_aufgabe_id) REFERENCES geschlossene_aufgabe(aufgabe_id)
);

CREATE TABLE aufgaben_klausur (
 PRIMARY KEY (aufgabe_id, klausur_id),
 aufgabe_id INT NOT NULL,
 klausur_id INT NOT NULL,
 punkte DECIMAL(4,1) NOT NULL,
 FOREIGN KEY (aufgabe_id) REFERENCES aufgabe(id),
 FOREIGN KEY (klausur_id) REFERENCES klausur(id)
);

CREATE TABLE aufgaben_modul (
 PRIMARY KEY (aufgabe_id, modul_id),
 aufgabe_id INT NOT NULL,
 modul_id INT NOT NULL,
 FOREIGN KEY (aufgabe_id) REFERENCES aufgabe(id),
 FOREIGN KEY (modul_id) REFERENCES modul(id)
);